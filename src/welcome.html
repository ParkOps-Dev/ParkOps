<!--
=========================================================
                        WELCOME.HTML
=========================================================
Ce script est le fichier de la première ouverture du
logiciel, il est là pour guider l'utilisateur.
Une pull request est autorisé sur ce script.
Si vous voulez plus d'informations, le script à une page
spécialisé sur ça.
-->

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration Initiale - Supervision Manèges</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-light: #3498db;
            --secondary-light: #2ecc71;
            --danger-light: #e74c3c;
            --dark-light: #2c3e50;
            --light-light: #f8f9fa;
            --bg-gradient-light: linear-gradient(135deg, #f8f9fa, #e9ecef);
            --card-bg-light: rgba(255, 255, 255, 0.95);
            --text-light: #212529;
            --border-light: rgba(0, 0, 0, 0.1);

            --primary-dark: #3498db;
            --secondary-dark: #2ecc71;
            --danger-dark: #e74c3c;
            --dark-dark: #1a1a2e;
            --light-dark: #ecf0f1;
            --bg-gradient-dark: linear-gradient(135deg, #1a2a6c, #b21f1f);
            --card-bg-dark: rgba(44, 62, 80, 0.9);
            --text-dark: #f8f9fa;
            --border-dark: rgba(255, 255, 255, 0.1);

            --primary: var(--primary-light);
            --secondary: var(--secondary-light);
            --danger: var(--danger-light);
            --dark: var(--dark-light);
            --light: var(--light-light);
            --bg-gradient: var(--bg-gradient-light);
            --card-bg: var(--card-bg-light);
            --text: var(--text-light);
            --border: var(--border-light);
        }

        body.dark-mode {
            --primary: var(--primary-dark);
            --secondary: var(--secondary-dark);
            --danger: var(--danger-dark);
            --dark: var(--dark-dark);
            --light: var(--light-dark);
            --bg-gradient: var(--bg-gradient-dark);
            --card-bg: var(--card-bg-dark);
            --text: var(--text-dark);
            --border: var(--border-dark);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .setup-container {
            background: var(--card-bg);
            border-radius: 15px;
            width: 100%;
            max-width: 800px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .setup-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text);
        }

        .setup-header i {
            font-size: 4rem;
            color: var(--secondary);
            margin-bottom: 20px;
        }

        .setup-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .setup-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .setup-steps {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .step {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            gap: 15px;
            align-items: flex-start;
            transition: all 0.3s ease;
            border-left: 5px solid transparent;
        }

        .step.active {
            border-left-color: var(--primary);
            background: rgba(52, 152, 219, 0.2);
        }

        .step.completed {
            border-left-color: var(--secondary);
            background: rgba(46, 204, 113, 0.2);
        }

        .step-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .step.active .step-icon {
            background: var(--primary);
            color: white;
        }

        .step.completed .step-icon {
            background: var(--secondary);
            color: white;
        }

        .step.inactive .step-icon {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .step-description {
            opacity: 0.8;
            font-size: 0.95rem;
            margin-bottom: 10px;
        }

        .step-form {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .step.active .step-form {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, 
        .form-group select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--primary);
        }

        .form-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .manege-list {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
        }

        .manege-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            margin-bottom: 8px;
            align-items: center;
        }

        .manege-item-actions {
            display: flex;
            gap: 5px;
        }

        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-outline {
            background: transparent;
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            opacity: 0.9;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .setup-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            border: none;
        }

        .btn-icon:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .hidden {
            display: none !important;
        }

        #completion-screen {
            text-align: center;
            padding: 30px;
        }

        #completion-screen i {
            font-size: 5rem;
            color: var(--secondary);
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: var(--text);
            opacity: 0.7;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }

        @media (max-width: 768px) {
            .setup-container {
                padding: 20px;
            }
            
            .step {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .step-icon {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body class="light-mode">
    <div class="setup-container">
        <div id="setup-steps-container">
            <div class="setup-header">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
                    <i class="fas fa-moon"></i>
                </button>
                <i class="fas fa-ferris-wheel"></i>
                <h1>Configuration Initiale</h1>
                <p>Configurez votre système de supervision de manèges en quelques étapes simples</p>
            </div>

            <div class="setup-steps">
                <div class="step active" id="step-1" data-validate="validateStep1">
                    <div class="step-icon">
                        <i class="fas fa-user-cog"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">1. Configuration de base</div>
                        <div class="step-description">Définissez les paramètres généraux de votre parc</div>
                        
                        <div class="step-form">
                            <div class="form-group">
                                <label for="park-name">Nom du parc d'attractions</label>
                                <input type="text" id="park-name" placeholder="Ex: Parc Fantastique" required>
                                <small class="error-message hidden">Ce champ est requis</small>
                            </div>
                            <div class="form-group">
                                <label for="park-location">Localisation</label>
                                <input type="text" id="park-location" placeholder="Ex: Paris, France" required>
                                <small class="error-message hidden">Ce champ est requis</small>
                            </div>
                            <div class="form-group">
                                <label for="park-timezone">Fuseau horaire</label>
                                <select id="park-timezone" required>
                                    <option value="">Sélectionnez un fuseau horaire</option>
                                    <option value="Europe/Paris">Europe/Paris (UTC+2)</option>
                                    <option value="America/New_York">America/New_York (UTC-4)</option>
                                    <option value="Asia/Tokyo">Asia/Tokyo (UTC+9)</option>
                                </select>
                                <small class="error-message hidden">Veuillez sélectionner un fuseau horaire</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="step inactive" id="step-2">
                    <div class="step-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">2. Ajout des manèges</div>
                        <div class="step-description">Ajoutez les manèges que vous souhaitez superviser</div>
                        
                        <div class="step-form">
                            <div class="form-group">
                                <label for="manege-name">Nom du manège</label>
                                <input type="text" id="manege-name" placeholder="Ex: Grande Roue" required>
                                <small class="error-message hidden">Ce champ est requis</small>
                            </div>
                            <div class="form-group">
                                <label for="manege-type">Type de manège</label>
                                <select id="manege-type" required>
                                    <option value="">Sélectionnez un type</option>
                                    <option value="adrenaline">Adrénaline</option>
                                    <option value="famille">Famille</option>
                                    <option value="enfant">Enfant</option>
                                    <option value="aquatique">Aquatique</option>
                                </select>
                                <small class="error-message hidden">Veuillez sélectionner un type</small>
                            </div>
                            <div class="form-group">
                                <label for="manege-capacity">Capacité maximale</label>
                                <input type="number" id="manege-capacity" min="1" value="20" required>
                                <small class="error-message hidden">La capacité doit être d'au moins 1</small>
                            </div>
                            <button class="btn btn-primary" id="add-manege-btn">
                                <i class="fas fa-plus"></i> Ajouter le manège
                            </button>

                            <div class="manege-list" id="manege-list">
                                <div class="empty-state">Aucun manège ajouté</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="step inactive" id="step-3" data-validate="validateStep3">
                    <div class="step-icon">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">3. Configuration matérielle</div>
                        <div class="step-description">Connectez vos capteurs et périphériques</div>
                        
                        <div class="step-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="connect-sensors" checked>
                                    Activer la détection automatique des capteurs
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="sensor-type">Type de capteur principal</label>
                                <select id="sensor-type" required>
                                    <option value="">Sélectionnez un type</option>
                                    <option value="rfid">RFID</option>
                                    <option value="camera">Caméra</option>
                                    <option value="infrared">Infrarouge</option>
                                </select>
                                <small class="error-message hidden">Veuillez sélectionner un type de capteur</small>
                            </div>
                            <div class="form-group" id="sensor-port-group">
                                <label for="sensor-port">Port de communication</label>
                                <input type="text" id="sensor-port" placeholder="Ex: COM3 ou /dev/ttyUSB0" required>
                                <small class="error-message hidden">Ce champ est requis</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="step inactive" id="step-4">
                    <div class="step-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">4. Paramètres d'alerte</div>
                        <div class="step-description">Configurez les seuils d'alerte et notifications</div>
                        
                        <div class="step-form">
                            <div class="form-group">
                                <label for="alert-capacity">Seuil de capacité (%)</label>
                                <input type="number" id="alert-capacity" min="1" max="100" value="90" required>
                                <small class="error-message hidden">Veuillez entrer une valeur entre 1 et 100</small>
                            </div>
                            <div class="form-group">
                                <label for="alert-wait">Seuil d'attente (minutes)</label>
                                <input type="number" id="alert-wait" min="1" value="30" required>
                                <small class="error-message hidden">Veuillez entrer une valeur d'au moins 1</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enable-email" checked>
                                    Activer les notifications par email
                                </label>
                            </div>
                            <div class="form-group" id="email-group">
                                <label for="admin-email">Email d'administration</label>
                                <input type="email" id="admin-email" placeholder="admin@votredomaine.com" required>
                                <small class="error-message hidden">Veuillez entrer un email valide</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="setup-footer">
                <button class="btn btn-outline" id="prev-btn" disabled>
                    <i class="fas fa-arrow-left"></i> Précédent
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Suivant <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <div id="completion-screen" class="hidden">
            <i class="fas fa-check-circle"></i>
            <h2>Configuration terminée !</h2>
            <p>Votre système de supervision de manèges est prêt à être utilisé.</p>
            <button class="btn btn-secondary" id="launch-app-btn">
                <i class="fas fa-play"></i> Lancer l'application
            </button>
        </div>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', () => {
    const steps = document.querySelectorAll('.step');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const setupContainer = document.getElementById('setup-steps-container');
    const completionScreen = document.getElementById('completion-screen');
    const launchAppBtn = document.getElementById('launch-app-btn');
    const addManegeBtn = document.getElementById('add-manege-btn');
    const manegeList = document.getElementById('manege-list');
    const enableEmail = document.getElementById('enable-email');
    const emailGroup = document.getElementById('email-group');
    const connectSensors = document.getElementById('connect-sensors');
    const sensorPortGroup = document.getElementById('sensor-port-group');
    const themeToggle = document.getElementById('theme-toggle');
    
    let currentStep = 0;
    const maneges = [];
    
    init();
    
    function init() {
        nextBtn.addEventListener('click', handleNext);
        prevBtn.addEventListener('click', handlePrev);
        addManegeBtn.addEventListener('click', addManege);
        enableEmail.addEventListener('change', toggleEmailField);
        connectSensors.addEventListener('change', toggleSensorPort);
        launchAppBtn.addEventListener('click', launchApp);
        themeToggle.addEventListener('click', toggleTheme);
        
        updateSteps();
        renderManegesList();
        toggleEmailField();
        toggleSensorPort();
        
        setupInputValidation();
        
        console.log('Next button:', nextBtn);
    }
    
    function handleNext() {
        console.log('Next button clicked');
        
        if (currentStep === 0) {
            const parkName = document.getElementById('park-name').value;
            if (!parkName) {
                alert('Veuillez entrer le nom du parc');
                return;
            }
        }
        
        if (currentStep < steps.length - 1) {
            currentStep++;
            updateSteps();
        } else {
            completeSetup();
        }
    }
    
    function handlePrev() {
        if (currentStep > 0) {
            currentStep--;
            updateSteps();
        }
    }
    
    function updateSteps() {
        steps.forEach((step, index) => {
            step.classList.remove('active', 'completed', 'inactive');
            
            if (index === currentStep) {
                step.classList.add('active');
            } else if (index < currentStep) {
                step.classList.add('completed');
            } else {
                step.classList.add('inactive');
            }
        });
        
        prevBtn.disabled = currentStep === 0;
        nextBtn.textContent = currentStep === steps.length - 1 ? 'Terminer' : 'Suivant';
        nextBtn.disabled = false;
        
        setTimeout(() => {
            steps[currentStep].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 100);
    }
    
    function setupInputValidation() {
        document.querySelectorAll('input[required], select[required]').forEach(input => {
            input.addEventListener('input', () => validateInput(input));
        });
    }
    
    function validateInput(input) {
        const errorMessage = input.parentElement.querySelector('.error-message');
        
        if (!input.checkValidity()) {
            input.classList.add('invalid');
            if (errorMessage) errorMessage.classList.remove('hidden');
            return false;
        } else {
            input.classList.remove('invalid');
            if (errorMessage) errorMessage.classList.add('hidden');
            return true;
        }
    }
    
    function validateCurrentStep() {
        let isValid = true;
        const currentStepEl = steps[currentStep];
        const requiredInputs = currentStepEl.querySelectorAll('input[required], select[required]');
        
        requiredInputs.forEach(input => {
            if (!validateInput(input)) {
                isValid = false;
            }
        });
        
        if (currentStep === 1 && maneges.length === 0) {
            alert('Veuillez ajouter au moins un manège');
            isValid = false;
        }
        
        return isValid;
    }
    
    function addManege() {
        const nameInput = document.getElementById('manege-name');
        const typeInput = document.getElementById('manege-type');
        const capacityInput = document.getElementById('manege-capacity');
        
        if (!nameInput.value || !typeInput.value) {
            validateInput(nameInput);
            validateInput(typeInput);
            return;
        }
        
        const manege = {
            id: Date.now(),
            name: nameInput.value.trim(),
            type: typeInput.value,
            capacity: parseInt(capacityInput.value) || 20
        };
        
        maneges.push(manege);
        renderManegesList();
        
        nameInput.value = '';
        typeInput.value = '';
        capacityInput.value = '20';
        nameInput.focus();
    }
    
    function removeManege(id) {
        const index = maneges.findIndex(m => m.id === id);
        if (index !== -1) {
            maneges.splice(index, 1);
            renderManegesList();
        }
    }
    
    function renderManegesList() {
        if (maneges.length === 0) {
            manegeList.innerHTML = '<div class="empty-state">Aucun manège ajouté</div>';
            return;
        }
        
        manegeList.innerHTML = '';
        
        maneges.forEach(manege => {
            const item = document.createElement('div');
            item.className = 'manege-item';
            item.innerHTML = `
                <span>${manege.name} (${getTypeName(manege.type)})</span>
                <div class="manege-item-actions">
                    <span>Capacité: ${manege.capacity}</span>
                    <button class="btn-icon btn-danger" data-id="${manege.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            manegeList.appendChild(item);
        });
        
        manegeList.querySelectorAll('.btn-danger').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const id = parseInt(btn.getAttribute('data-id'));
                removeManege(id);
            });
        });
    }
    
    function getTypeName(type) {
        const types = {
            'adrenaline': 'Adrénaline',
            'famille': 'Famille',
            'enfant': 'Enfant',
            'aquatique': 'Aquatique'
        };
        return types[type] || type;
    }
    
    function toggleEmailField() {
        const emailField = document.getElementById('admin-email');
        if (enableEmail.checked) {
            emailGroup.style.display = 'block';
            emailField.required = true;
        } else {
            emailGroup.style.display = 'none';
            emailField.required = false;
            emailField.classList.remove('invalid');
            emailGroup.querySelector('.error-message').classList.add('hidden');
        }
    }
    
    function toggleSensorPort() {
        const portField = document.getElementById('sensor-port');
        if (connectSensors.checked) {
            sensorPortGroup.style.display = 'none';
            portField.required = false;
            portField.classList.remove('invalid');
            sensorPortGroup.querySelector('.error-message').classList.add('hidden');
        } else {
            sensorPortGroup.style.display = 'block';
            portField.required = true;
        }
    }
    
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const icon = themeToggle.querySelector('i');
        icon.classList.toggle('fa-moon');
        icon.classList.toggle('fa-sun');
    }
    
    function completeSetup() {
        if (maneges.length === 0) {
            alert('Veuillez ajouter au moins un manège avant de continuer.');
            currentStep = 1;
            updateSteps();
            return;
        }
        
        if (!validateCurrentStep()) return;
        
        saveConfiguration();
        setupContainer.classList.add('hidden');
        completionScreen.classList.remove('hidden');
    }
    
    function saveConfiguration() {
        const config = {
            park: {
                name: document.getElementById('park-name').value,
                location: document.getElementById('park-location').value,
                timezone: document.getElementById('park-timezone').value
            },
            maneges: maneges,
            hardware: {
                autoDetect: connectSensors.checked,
                sensorType: document.getElementById('sensor-type').value,
                port: connectSensors.checked ? 'auto' : document.getElementById('sensor-port').value
            },
            alerts: {
                capacityThreshold: document.getElementById('alert-capacity').value,
                waitThreshold: document.getElementById('alert-wait').value,
                emailNotifications: enableEmail.checked,
                adminEmail: enableEmail.checked ? document.getElementById('admin-email').value : null
            },
            themePreference: document.body.classList.contains('dark-mode') ? 'dark' : 'light'
        };
        
        console.log('Configuration à sauvegarder:', config);
        localStorage.setItem('manegeConfig', JSON.stringify(config));
        
        if (window.electronAPI) {
            window.electronAPI.saveInitialConfig(config);
        }
    }
    
    function launchApp() {
        if (window.electronAPI) {
            window.electronAPI.launchMainApp();
        } else {
            window.location.href = 'index.html';
        }
    }
});
    </script>
</body>
</html>